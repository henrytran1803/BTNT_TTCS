CREATE PROCEDURE sp_themCTL

    @MACTL nchar(8),

    @MATPNT nchar(8)

AS

BEGIN

    SET NOCOUNT ON;

DECLARE @NgayBatDau DATETIME

DECLARE @NgayKetThuc DATETIME

SET @NgayBatDau = (SELECT NGAYBATDAU FROM CUOC_TRIEN_LAM WHERE MACTL = @MACTL)

    SET @NgayKetThuc = (SELECT NGAYKETTHUC FROM CUOC_TRIEN_LAM WHERE MACTL = @MACTL)

IF @NgayBatDau < GETDATE() OR @NgayKetThuc < GETDATE()

                return 1;

IF EXISTS (

SELECT 1

FROM CT_CTL C

JOIN CUOC_TRIEN_LAM TL ON TL.MACTL = C.MACTL

WHERE C.MATPNT = @MATPNT

AND ((TL.NGAYBATDAU < @NgayBatDau AND TL.NGAYKETTHUC > @NgayKetThuc)

OR (TL.NGAYBATDAU < @NgayBatDau AND TL.NGAYKETTHUC < @NgayKetThuc)

OR (TL.NGAYBATDAU > @NgayBatDau AND TL.NGAYKETTHUC < @NgayKetThuc))

)

BEGIN

RETURN 1

END

ELSE

BEGIN

RETURN 0

END

END







CREATE PROCEDURE sp_kiemtraxoaCTCTL
    @MACTL nchar(8)
AS
BEGIN
    DECLARE @NgayBatDau datetime
    DECLARE @NgayKetThuc datetime
    SET @NgayBatDau = (SELECT NGAYBATDAU FROM CUOC_TRIEN_LAM WHERE MACTL = @MACTL)
    SET @NgayKetThuc = (SELECT NGAYKETTHUC FROM CUOC_TRIEN_LAM WHERE MACTL = @MACTL)

    IF @NgayKetThuc < GETDATE() OR @NgayBatDau < GETDATE()
                return 1;

    return 0
END
